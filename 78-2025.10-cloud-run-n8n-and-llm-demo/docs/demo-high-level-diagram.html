<!DOCTYPE html>
<html>
<head>
    <title>Cloud Run Demo Architecture (Modern)</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Roboto:ital,wght@0,400;0,500;1,400&display=swap" rel="stylesheet">
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f8f9fa;
            font-family: 'Google Sans', Arial, sans-serif;
        }
        svg {
            background-color: #ffffff;
            border: 1px solid #dadce0;
            max-width: 100%;
            max-height: 100vh;
        }

        /* Base Text Styles */
        .label-title {
            font-size: 24px;
            font-weight: 500;
            fill: #202124;
        }
        .label-url {
            font-size: 19px;
            font-family: 'Roboto', Arial, sans-serif;
            font-style: italic;
            fill: #5f6368;
        }
        .label-config {
            font-size: 20px;
            font-family: 'Roboto', Arial, sans-serif;
            fill: #202124;
        }
        .label-config-key {
            font-weight: 500;
        }
        .label-config-allow {
            fill: #34A853; /* Google Green */
            font-weight: 500;
        }
        .label-config-deny {
            fill: #EA4335; /* Google Red */
            font-weight: 500;
        }

        /* Boxes */
        .box {
            fill: #ffffff;
            stroke: #4285F4; /* Google Blue */
            stroke-width: 2;
            rx: 8;
        }
        .box-alb {
            fill: #ffffff;
            stroke: #34A853; /* Google Green */
            stroke-width: 2;
            rx: 8;
        }
        .box-invoker {
            fill: #F1F8E9; /* Light green */
            stroke: #34A853;
            stroke-width: 1.5;
            rx: 4;
        }

        /* Arrows */
        .arrow {
            stroke: #5f6368;
            stroke-width: 2.5;
            marker-end: url(#arrowhead);
            fill: none;
        }
        .arrow-auth {
            stroke: #4285F4; /* Google Blue */
            stroke-width: 3;
            marker-end: url(#arrowhead-auth);
            fill: none;
            stroke-dasharray: 8 4;
        }
        .arrow-label {
            font-size: 18px;
            fill: #5f6368;
            font-family: 'Roboto', Arial, sans-serif;
        }
        .arrow-label-auth {
            font-size: 20px;
            fill: #4285F4;
            font-weight: 500;
        }

        /* Icons & Markers */
        .user-icon {
            font-size: 80px;
            text-anchor: middle;
        }
    </style>
</head>
<body>
    <svg width="1600" height="900" viewBox="0 0 1600 900">
        <defs>
            <marker
                id="arrowhead"
                markerWidth="10"
                markerHeight="7"
                refX="0"
                refY="3.5"
                orient="auto">
                <polygon points="0 0, 10 3.5, 0 7" fill="#5f6368" />
            </marker>
            <marker
                id="arrowhead-auth"
                markerWidth="10"
                markerHeight="7"
                refX="0"
                refY="3.5"
                orient="auto">
                <polygon points="0 0, 10 3.5, 0 7" fill="#4285F4" />
            </marker>
        </defs>

        <text x="800" y="50" text-anchor="middle" font-size="32" font-weight="500">Demo Setup</text>

        <g>
            <text x="100" y="460" class="user-icon">ðŸ‘¤</text>
            <text x="100" y="540" text-anchor="middle" class="label-title">User</text>
        </g>

        <g>
            <rect x="300" y="400" width="300" height="150" class="box-alb" />
            <text x="450" y="440" text-anchor="middle" class="label-title">External Load Balancer</text>
            <text x="450" y="480" text-anchor="middle" class="label-config">
                <tspan class="label-config-key">Feature:</tspan> IAP Enabled
            </text>
        </g>

        <g>
            <rect x="700" y="250" width="400" height="310" class="box" /> <text x="900" y="290" text-anchor="middle" class="label-title">Cloud Run: n8n</text>
            <text x="900" y="325" text-anchor="middle" class="label-url">n8n.my-custom-domain.com</text>

            <text x="730" y="370" class="label-config">
                <tspan class="label-config-key">Ingress:</tspan> <tspan class="label-config-allow">Internal + LB</tspan>
            </text>
            <text x="730" y="405" class="label-config">
                <tspan class="label-config-key">Identity:</tspan> n8n-sa
            </text>

            <rect x="720" y="435" width="360" height="120" class="box-invoker" />
            <text x="900" y="465" text-anchor="middle" class="label-config label-config-key">Invoker Check:</text>
            <text x="900" y="495" text-anchor="middle" class="label-config label-config-allow" style="font-size: 19px;">
                service-${PROJECT_NUMBER}
            </text>
            <text x="900" y="525" text-anchor="middle" class="label-config label-config-allow" style="font-size: 19px;">
                @gcp-sa-iap.iam.gserviceaccount.com
            </text>
        </g>

        <g>
            <rect x="1200" y="400" width="350" height="290" class="box" />
            <text x="1375" y="440" text-anchor="middle" class="label-title">Cloud Run: gemma</text>
            <text x="1375" y="475" text-anchor="middle" class="label-url">gemma-xyz-abc.a.run.app</text>

            <text x="1230" y="525" class="label-config">
                <tspan class="label-config-key">Ingress:</tspan> <tspan class="label-config-deny">Internal</tspan>
            </text>

            <rect x="1220" y="560" width="310" height="125" class="box-invoker" />
            <text x="1375" y="590" text-anchor="middle" class="label-config label-config-key">Invoker Check:</text>
            <text x="1375" y="615" text-anchor="middle" class="label-config label-config-allow">n8n-service</text>
            <text x="1375" y="645" text-anchor="middle" class="label-config label-config-allow">@${PROJECT_ID}</text>
            <text x="1375" y="675" text-anchor="middle" class="label-config label-config-allow">.iam.gserviceaccount.com</text>
        </g>

        <path d="M 180 475 H 290" class="arrow" />
        <text x="235" y="465" text-anchor="middle" class="arrow-label">HTTPS</text>

        <path d="M 450 400 Q 450 350, 690 350" class="arrow" />
        <text x="570" y="325" text-anchor="middle" class="arrow-label">Allowed by</text>
        <text x="570" y="350" text-anchor="middle" class="arrow-label">Ingress: Internal + LB</text>

        <path d="M 1110 350 H 1300 Q 1350 350, 1375 390" class="arrow-auth" />
        <text x="1205" y="320" text-anchor="start" class="arrow-label-auth">Authenticated Call</text>
        <text x="1205" y="345" text-anchor="start" class="arrow-label-auth">(as n8n-sa@...)</text>

    </svg>
</body>
</html>
